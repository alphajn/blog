import{t as T,b as k,V as x}from"./kline.DURS2Yqo.js";import{L as C,W as R}from"./Watermark.DxzaBBpe.js";import{d as w,a4 as D,h as d,v as B,q as c,a8 as S,o as _,c as I,j as P,b as u,e as y,_ as q}from"./framework.Ch6Llh6T.js";const M={class:"tv-chart"},V=w({inheritAttrs:!1,__name:"Tv",props:T,emits:["plusClick"],setup(p,{expose:g,emit:f}){const e=p,v=f,a=D({el:null,chart:null,chart_ready:!1,chart_loading:!0,active_chart:void 0,mounted:!1,get_bar_times:1}),b=d(()=>e.interval&&e.symbol&&a.mounted),h=d(()=>`${e.symbol}_${e.interval}`),r={init(){a.chart=k(a.el,{symbol:e.symbol,interval:e.interval,locale:e.lang,storeKey:e.storeKey,library_path:e.libraryPath,showMa:e.showMa,theme:e.theme,custom_css_url:e.customCssUrl,datafeed:{searchSymbols(t,s,i,o){o([{symbol:e.symbol,full_name:`${e.exchange}:${e.symbol}`,description:"",exchange:e.exchange,type:"crypto"}])},resolveSymbol(t,s){a.chart._iFrame.style.opacity==="0"&&(a.chart._iFrame.style.opacity="1",a.chart_loading=!1);const i={name:t,ticker:t,description:t,exchange:e.exchange,listed_exchange:e.exchange,type:"crypto",session:"24x7",timezone:"Etc/UTC",minmov:1,minmove2:0,pricescale:10**e.pricePrecision,format:"price",has_seconds:!0,has_intraday:!0,has_daily:!0,has_weekly_and_monthly:!0,volume_precision:e.quantityPrecision,visible_plots_set:e.showVol?"ohlcv":"ohlc"};setTimeout(()=>{s(i)})},getBars:(t,s,i,o)=>{var l;i.firstDataRequest?(a.get_bar_times=1,!e.loading&&(!e.list.length||h.value===((l=e.list[0])==null?void 0:l.id))?o(e.list):r.onResult=o):(a.get_bar_times+=1,a.get_bar_times===2&&e.list.length<e.limitSize?o([],{noData:!0}):e.loadMore(e.list[0].time,n=>{var m;(!n.length||h.value===((m=n[0])==null?void 0:m.id))&&o(n,{noData:n.length<e.limitSize})}))},subscribeBars(t,s,i,o,l){r.onTick=i,r.onResetCache=l,e.latestData&&i(e.latestData)}},onPlusClick:t=>{v("plusClick",t)}}),a.chart.onChartReady(()=>{var s,i,o,l;a.chart_ready=!0,a.active_chart=(s=a.chart)==null?void 0:s.activeChart(),r.changeTheme(),((i=a.active_chart)==null?void 0:i.chartType())!==e.graph&&((o=a.active_chart)==null||o.setChartType(e.graph));const t=(l=a.active_chart)==null?void 0:l.getTimeScale();t==null||t.setRightOffset(7)})},onResult(t,s){},onTick(t){},onResetCache(){},reset(){r.onResult=()=>{},r.onTick=()=>{}},changeTheme(){var t;a.chart_ready&&((t=a.chart)==null||t.changeTheme(e.theme).then(()=>{var s;(s=a.chart)==null||s.applyOverrides(x(e.theme))}))}};return B(()=>{a.mounted=!0}),c(b,t=>{t&&r.init()}),c(()=>e.symbol,t=>{var s;a.chart_ready&&t&&(r.onResult(e.list),r.reset(),(s=a.active_chart)==null||s.setSymbol(t))}),c(()=>e.interval,t=>{var s;a.chart_ready&&t&&(r.reset(),(s=a.active_chart)==null||s.setResolution(t))}),c([()=>e.list,()=>e.loading],([t,s])=>{var i;!t.length&&s||(!(t!=null&&t.length)||h.value===((i=t[0])==null?void 0:i.id))&&(r.onResult(t),r.onResult=()=>{})},{immediate:!0}),c(()=>e.latestData,t=>{t&&r.onTick(t)}),c(()=>e.lang,t=>{var s;t&&a.chart_ready&&((s=a.chart)==null||s.remove(),r.init(),a.chart_ready=!1,a.chart_loading=!0,a.active_chart=void 0)}),c(()=>e.theme,t=>{t&&r.changeTheme()}),c(()=>e.exchange,t=>{var s;t&&(r.onResetCache(),(s=a.active_chart)==null||s.resetData(),r.reset())}),c(()=>e.graph,t=>{var s;(s=a.active_chart)==null||s.setChartType(t,()=>{})}),g({chart:S(a,"chart")}),(t,s)=>(_(),I("section",M,[P("div",{ref:i=>a.el=i,class:"tv-body"},null,512),e.loading||a.chart_loading?(_(),u(C,{key:0,color:e.loadingColor},null,8,["color"])):y("",!0),e.watermark?(_(),u(R,{key:1,text:e.watermark},null,8,["text"])):y("",!0)]))}}),F=q(V,[["__scopeId","data-v-efa4bb38"]]);export{F as T};
