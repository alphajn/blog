import{d as ks,h as ds,o as B,c as L,n as es,j as u,P as Es,e as gs,r as ys,u as os,G as cs,a6 as Fs,y as As,a1 as us,v as as,F as Ds,E as Cs,b as ms,w as ts,a as M,t as bs,I as Y,_ as Bs,a5 as fs}from"./chunks/framework.VWMa53FW.js";import{_ as vs}from"./chunks/Symbol.vue_vue_type_script_setup_true_lang.BtyPAB4z.js";import{_ as xs}from"./chunks/Button.DCbzwyqF.js";import{f as w,a as y,y as V,N as ns,c as q,d as F,s as O,x as P,u as T,S as hs}from"./chunks/index.BbVwo5FL.js";import{I as ws,w as qs}from"./chunks/config.C3IDp1Hm.js";import"./chunks/Select.eafu8-XS.js";const Ps={class:"relative"},Ts=ks({__name:"Loading",props:{loading:{type:Boolean,default:!1},size:{type:String,default:""},color:{type:String,default:"#E6A23C"}},setup(k){const i=k,s=ds(()=>({"text-72px":i.size==="big","text-46px":i.size==="","text-24px":i.size==="small","text-14px":i.size==="mini"}));return(t,a)=>(B(),L("div",Ps,[k.loading?(B(),L("div",{key:0,class:es(["absolute grid grid-place-content-center inset-0 bg-#000/5 cursor-progress z-1",s.value])},[u("span",{class:"i-svg-spinners:tadpole block",style:Es({color:k.color})},null,4)],2)):gs("",!0),ys(t.$slots,"default")]))}});function ls(k="dark"){const i=k==="light";return{grid:{top:0,bottom:50,gap:4,position:"left"},buy:"#19bf86",sell:"#f8495e",lineWidth:2,buyGradient:["rgba(25, 191, 134, 0)","rgba(25, 191, 134, 0.2)"],sellGradient:["rgba(248, 73, 94, 0)","rgba(248, 73, 94, 0.2)"],tooltip:{padding:10,size:20,color:i?"black":"white",bg:i?"#fff":"#16171A",maskColor:"rgba(0, 0, 0, 0.02)"},separator:{size:2,color:i?"black":"white"},axis:{size:20,color:i?"black":"white",lineColor:i?"black":"white"}}}var _s=Object.defineProperty,Ls=(k,i,s)=>i in k?_s(k,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):k[i]=s,d=(k,i,s)=>(Ls(k,typeof i!="symbol"?i+"":i,s),s);function ps(k){const i=[];return k.forEach((s,t)=>{let a=s[1];t>0&&(a=F(a,i[t-1].total)),i.push({price:String(s[0]),quantity:String(s[1]),total:String(a)})}),i}function $(k,i,s,t,a,h=!1){k.beginPath(),k.lineWidth=i,k.strokeStyle=s,h&&k.setLineDash([6,6]),k.moveTo(t[0],t[1]),k.lineTo(a[0],a[1]),k.stroke(),k.closePath()}function b(k,i,s,t,a=8){k.beginPath(),k.fillStyle=t,k.arc(i,s,a,0,2*Math.PI,!0),k.fill(),k.closePath()}function W(k,i,s,t,a,h,l=20,p=8){k.beginPath(),k.fillStyle=i,l&&(k.shadowBlur=l,k.shadowColor="rgba(0, 0, 0, 0.2)"),k.roundRect(s,t,a,h,p),k.fill(),k.closePath()}const _=(k,i)=>k.measureText(i).width||0;class Ss{constructor(i,s){if(d(this,"el"),d(this,"ready",!1),d(this,"canvas",null),d(this,"tooltip",null),d(this,"ratio",2),d(this,"ctx",null),d(this,"tooltipCtx",null),d(this,"pricePrecision",2),d(this,"quantityPrecision",4),d(this,"style",ls()),d(this,"middle",0),d(this,"max",""),d(this,"cW",0),d(this,"cH",0),d(this,"xTickWidth",120),d(this,"left",120),d(this,"buyList",[]),d(this,"sellList",[]),d(this,"lastPrice","0"),d(this,"requestAnimation",0),d(this,"showTooltip",!1),d(this,"tooltipAnimation",0),d(this,"clientX",0),d(this,"clientY",0),d(this,"texts",{buy:"Buy",sell:"Sell"}),typeof i=="string"?this.el=document.querySelector(i):this.el=i,!this.el)throw new Error("el 获取出错~!~");s!=null&&s.theme&&this.setTheme(s.theme,!1),s!=null&&s.style&&this.setStyle(s.style,!1),this.init()}init(){const i=this.el.querySelectorAll("canvas");i!=null&&i.length&&i.forEach(s=>{this.el.removeChild(s)}),this.el.style.position="relative",this.canvas=document.createElement("canvas"),this.el.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.tooltip=document.createElement("canvas"),this.el.appendChild(this.tooltip),this.tooltipCtx=this.tooltip.getContext("2d"),this.tooltip.style.position="absolute",this.tooltip.style.left="0",this.tooltip.style.top="0",this.resizeObserver(),this.listenMove()}resizeObserver(){new ResizeObserver(()=>{this.resize()}).observe(this.el)}setData(i,s){this.requestAnimation&&cancelAnimationFrame(this.requestAnimation),this.requestAnimation=requestAnimationFrame(()=>{const t=Math.min(i.length,s.length),a=i.slice(0,t).sort((l,p)=>Number(w(p[0],l[0]))),h=s.slice(0,t).sort((l,p)=>Number(w(l[0],p[0])));this.buyList=ps(a).reverse(),this.sellList=ps(h),this.ready&&this.updateDraw()})}draw(){if(!this.canvas||!this.ctx)return;const{ctx:i,style:s}=this;if(i.clearRect(0,0,this.canvas.width,this.canvas.height),!this.buyList.length)return;i.font=`${s.axis.size}px Verdana, Arial, Helvetica, sans-serif`,this.max=y(V(this.buyList[0].total,this.sellList.slice(-1)[0].total),1.35);const t=this.getTickPrecision(),a=this.getXTickList(t);this.xTickWidth=Number(V(...a.map(l=>_(i,`${ns(l,t)} -`)+18))),this.left=this.style.grid.position==="right"?0:this.xTickWidth,this.cW=this.canvas.width-this.xTickWidth-s.grid.gap*2-s.separator.size,this.middle=(this.canvas.width-this.xTickWidth)/2;const h=q(this.cW,2*this.buyList.length);this.drawBuy(h),this.drawSell(h),this.drawGrid(),this.drawXTick(a,t),this.drawYTick()}drawBuy(i){const{ctx:s,style:t}=this,a=this.left+t.lineWidth/2;s&&(s.beginPath(),s.moveTo(a,this.cH),s.strokeStyle=t.buy,s.lineWidth=t.lineWidth,this.buyList.forEach((h,l)=>{const p=F(a,y(i,l)),n=Number(F(p,i)),E=this.matchX(this.buyList[l].total);s.lineTo(Number(p),E),s.lineTo(n,E),l===this.buyList.length-1&&s.lineTo(n,this.cH)}),s.stroke(),this.drawArea(a,a,t.buyGradient),s.closePath())}drawSell(i){const{ctx:s,style:t}=this,a=F(this.middle,this.left),h=Number(F(a,t.grid.gap));s&&(s.beginPath(),s.moveTo(h,this.cH),s.strokeStyle=t.sell,s.lineWidth=t.lineWidth,this.sellList.forEach((l,p)=>{const n=F(h,y(i,p)),E=Number(F(n,i)),r=this.matchX(this.sellList[p].total);s.lineTo(Number(n),r),s.lineTo(E,r),p===this.sellList.length-1&&s.lineTo(E,this.cH)}),s.stroke(),this.drawArea(h,h,t.sellGradient),s.closePath())}drawGrid(){const{ctx:i,style:s}=this,{top:t}=s.grid;if(!i||!this.canvas)return;const a=this.left+s.lineWidth/2;let h=a;const l=s.grid.position==="right";l&&(h=this.canvas.width-this.xTickWidth),[{color:s.axis.lineColor,width:s.lineWidth,from:[h,this.cH],to:[h,t]},{color:s.separator.color,width:s.separator.size,from:[this.middle+this.left,this.cH],to:[this.middle+this.left,t]},{color:s.axis.lineColor,width:s.lineWidth,from:[a,this.cH],to:[l?h:this.canvas.width,this.cH]}].forEach(p=>{$(i,p.width,p.color,p.from,p.to)})}getXTickList(i){const s=O(q(this.max,6),i+2,0);let t=1;const a=[];for(;t<6;){const h=y(s,t);a.push(h),t+=1}return a}drawXTick(i,s){const{ctx:t,canvas:a,style:h,xTickWidth:l}=this;if(!t||!a)return;const p=h.grid.position==="right",n=p?a.width-l:l;t.fillStyle=h.axis.color,t.textAlign=p?"left":"right",i.forEach(E=>{const r=this.matchX(E),e=ns(E,s),g=p?`- ${e}`:`${e} -`;t.fillText(g,n,r)})}drawYTick(i=!1){const{ctx:s,canvas:t,style:a,left:h}=this;if(!s||!t||!this.buyList.length)return;const l=this.middle/2,p=a.lineWidth/2;let n=[{x:h+p,side:"buy",align:"left"},{x:l+h,side:"buy",align:"center"},{x:this.middle+h,price:P(this.lastPrice,0)?this.lastPrice:this.buyList.slice(-1)[0].price,side:"buy",align:"center"},{x:l*3+h,side:"sell",align:"center"},{x:t.width-(a.grid.position==="right"?this.xTickWidth:p),side:"sell",align:"right"}];s.fillStyle=a.axis.color;const E=_(s,T(this.sellList[0].price,this.pricePrecision));i?(n=n.filter((r,e)=>e===2),s.clearRect(this.middle+h-E/2,this.cH+12,E,a.axis.size)):(E*1.7>this.cW/4||this.buyList.length<2)&&(n=n.filter((r,e)=>![1,3].includes(e))),n.forEach(r=>{var o,A;const e=this.matchY(r.x,r.side);let g=r.price||"0.00";s.textAlign=r.align,!r.price&&e>=0&&(g=r.side==="buy"?(o=this.buyList[e])==null?void 0:o.price:(A=this.sellList[e])==null?void 0:A.price),s.fillText(`${T(g||"0.00",this.pricePrecision)}`,r.x,this.cH+10+a.axis.size),$(s,2,a.axis.lineColor,[r.x,this.cH+2],[r.x,this.cH+10])})}drawArea(i,s,t){if(this.ctx){const a=this.ctx.createLinearGradient(i,this.cH,s,170);a.addColorStop(1,t[1]),a.addColorStop(0,t[0]),this.ctx.fillStyle=a,this.ctx.fill()}}drawTooltip(){const{tooltip:i,tooltipAnimation:s,tooltipCtx:t,showTooltip:a,clientX:h,clientY:l,middle:p,style:n,left:E,buyList:r,sellList:e,quantityPrecision:g,texts:o,xTickWidth:A}=this;s&&cancelAnimationFrame(s),this.tooltipAnimation=requestAnimationFrame(()=>{if(!t||!i||(t.clearRect(0,0,i.width,i.height),!a))return;const c=h<p+E-n.grid.gap,f=h>p+E+n.grid.gap,v=this.matchY(h,c?"buy":"sell");if(!c&&!f||!r[v])return;t.font=`${n.tooltip.size}px Verdana, Arial, Helvetica, sans-serif`;const D=8,S=c?r[v]:r[r.length-v-1],z=f?e[v]:e[r.length-v-1];let H="0.00";const X=`${o.buy}: ${T(S.total,g)}`,N=`${o.sell}: ${T(z.total,g)}`,rs=V(_(t,X),_(t,N)),I=Number(F(F(rs,n.tooltip.padding*2),D*2+10)),R=n.tooltip.padding*2+n.tooltip.size*3+24,j=c?this.clientX+20:this.clientX-I-20,U=l>this.cH-R-n.lineWidth?this.cH-R-n.lineWidth:l,J=n.grid.position==="left"?A:-A,C=c?h:i.width-h+J,m=f?h:i.width-h+J,K=this.matchX(S.total),Q=this.matchX(z.total);c&&(H=O(y(q(hs(w(S.price,this.lastPrice)),this.lastPrice),100),2)),f&&(H=O(y(q(hs(w(z.price,this.lastPrice)),this.lastPrice),100),2)),b(t,C,K,n.buyGradient[1],12),b(t,C,K,n.buy),$(t,n.lineWidth,n.buy,[C,n.grid.top],[C,this.cH+10],!0),W(t,n.tooltip.maskColor,E,n.grid.top,C-E,this.cH,0,0),this.drawPriceRect(C,S.price),b(t,m,Q,n.sellGradient[1],12),b(t,m,Q,n.sell),$(t,n.lineWidth,n.sell,[m,n.grid.top],[m,this.cH+10],!0),W(t,n.tooltip.maskColor,m,n.grid.top,C-E,this.cH,0,0),this.drawPriceRect(m,z.price),W(t,n.tooltip.bg,j,U,I,R);const Z=U+n.tooltip.padding+n.tooltip.size/2,G=Z+n.tooltip.size+12,ss=G+n.tooltip.size+12,x=j+n.tooltip.padding,is=c?n.buy:n.sell;t.textAlign="left",t.textBaseline="middle",t.fillStyle=is,t.fillText(`${H}%`,x,Z),b(t,x+D,G-1,is,D),t.fillStyle=n.tooltip.color,t.fillText(c?X:N,x+D*2+10,G),b(t,x+D,ss-1,f?n.buy:n.sell,D),t.fillStyle=n.tooltip.color,t.fillText(c?N:X,x+D*2+10,ss)})}drawPriceRect(i,s){if(!this.tooltipCtx||!this.tooltip)return;const t=T(s,this.pricePrecision),a=_(this.tooltipCtx,t)+10;let h=i-a/2;const l=this.style.axis.size+8,p=this.tooltip.width-a/2,n=this.style.grid.position==="right";h<this.left?h=this.left:i>(n?p-this.xTickWidth:p)&&(h=this.tooltip.width-a,n&&(h-=this.xTickWidth)),W(this.tooltipCtx,"rgb(76, 82, 94)",h,this.cH+10,a,l,0,4),this.tooltipCtx.fillStyle="#fff",this.tooltipCtx.fillText(t,h+5,this.cH+10+l/2)}matchY(i,s){const{gap:t}=this.style.grid,a=this.left+this.middle+t+this.style.separator.size,h=s==="sell"?a:this.left;return Math.floor((i-h)*this.buyList.length/(this.cW/2))}matchX(i){const s=y(q(i,this.max),this.cH);return Math.round(Number(w(this.cH,s)))}updateDraw(){this.draw(),this.showTooltip&&this.drawTooltip()}getTickPrecision(){let i=this.quantityPrecision;return P(this.max,1e3)?i=2:P(this.max,10)?i=0:P(this.max,1)?i=1:P(this.max,.1)&&(i=2),i}listenMove(){this.tooltip&&(this.tooltip.addEventListener("mousemove",this.mousemove.bind(this),!1),this.tooltip.addEventListener("mouseout",this.mouseout.bind(this),!1))}mousemove(i){if(!this.tooltip)return;this.clientX=i.offsetX*this.ratio,this.clientY=i.offsetY*this.ratio;const s=this.style.grid.position==="right"?this.tooltip.width-this.xTickWidth:this.tooltip.width;this.showTooltip=this.clientX>this.left&&this.clientX<s,this.drawTooltip()}mouseout(){this.showTooltip=!1,this.clientX=0,this.clientY=0,this.drawTooltip()}updateLastPrice(i){this.lastPrice=i,this.drawYTick(!0)}setPrecision(i=2,s=4){this.pricePrecision=i,this.quantityPrecision=s,this.buyList.length&&this.updateDraw()}setTheme(i,s=!0){this.style=ls(i||"dark"),s&&this.updateDraw()}getStyle(){return this.style}setStyle(i,s=!0){this.style={...this.style,...i},s&&this.updateDraw()}resize(){if(this.ready=!0,this.canvas){const{width:i,height:s}=this.el.getBoundingClientRect();[this.canvas,this.tooltip].forEach(t=>{t&&(t.style.width=`${i}px`,t.style.height=`${s}px`,t.width=i*this.ratio,t.height=s*this.ratio)}),this.cH=this.canvas.height-this.style.grid.bottom}this.buyList.length&&this.updateDraw()}setLang(i){this.texts=i,this.drawTooltip()}}const zs={class:"flex flex-row flex-wrap mb-12px gap-10px"},$s=ks({__name:"Depth",setup(k){const i={theme:"修改主题",big:"大数样式",precision:"高精度",changeText:"更新tooltip文本",reset:"重置"},{isDark:s}=os(),t=cs(null),a=Fs({el:null,chart:null,loading:!1,actives:new Set,buys:[],sells:[],modified:!1,symbol:"BTCUSDT",symbols:{}}),h={init(){a.modified=!1,a.actives=new Set,a.chart=new Ss(a.el,{theme:s.value?"dark":"light"}),h.send()},send(){var l;a.loading=!0,(l=t.value)==null||l.send({event:"sub",topic:"depth",symbol:a.symbol,id:`sub_depth_${a.symbol}`},p=>{var n,E,r,e;a.loading&&((n=a.chart)==null||n.updateLastPrice("0"),(E=a.chart)==null||E.setPrecision(a.symbols.priceDecimal,a.symbols.qtyDecimal),(r=t.value)==null||r.send({event:"sub",topic:"realtimes",symbol:a.symbol,id:`sub_realtimes_${a.symbol}`},g=>{var A;const o=((g==null?void 0:g.data)||[]).slice(-1);o.length&&((A=a.chart)==null||A.updateLastPrice(a.actives.has("big")?y(o[0].c,1e4):o[0].c))})),a.loading=!1,a.sells=a.actives.has("big")?h.format3big(p.data[0].a):p.data[0].a,a.buys=a.actives.has("big")?h.format3big(p.data[0].b):p.data[0].b,(e=a.chart)==null||e.setData(a.buys,a.sells)})},unSend(l){var p,n;(p=t.value)==null||p.send({event:"cancel",topic:"depth",symbol:l||a.symbol,id:`sub_depth_${l||a.symbol}`},()=>{}),(n=t.value)==null||n.send({event:"cancel",topic:"realtimes",symbol:l||a.symbol,id:`sub_realtimes_${l||a.symbol}`},()=>{})},changeStyle(){var l;(l=a.chart)==null||l.setStyle({buy:"#67C23A",sell:"#F56C6C",buyGradient:["rgba(32, 178, 108, 0.01)","#67C23A"],sellGradient:["rgba(239, 69, 74, 0.01)","#F56C6C"],grid:{position:"right",top:0,bottom:50,gap:4},separator:{size:2,color:"#E6A23C"},axis:{size:20,color:"#E6A23C",lineColor:"#409EFF"}})},onClick(l){var p,n;if(!a.actives.has(l)){switch(l){case"reset":h.unSend(),h.init();break;case"theme":h.changeStyle();break;case"precision":(p=a.chart)==null||p.setPrecision(10,10);break;case"changeText":(n=a.chart)==null||n.setLang({buy:"买呀",sell:"卖呀"});break}l!=="reset"?(a.modified=!0,a.actives.add(l)):a.modified=!1}},format3big(l){return l.map(p=>[y(p[0],1e4),y(p[1],1e10)])},changeSymbol(l){a.symbols=l}};return As(()=>{t.value=new ws(qs,{heart:!0}),h.init()}),us(()=>{h.unSend()}),as(()=>s.value,l=>{var p;a.actives.has("theme")&&a.actives.delete("theme"),(p=a.chart)==null||p.setTheme(l?"dark":"light")},{immediate:!0}),as(()=>a.symbol,(l,p)=>{h.unSend(p),h.send()}),(l,p)=>{const n=xs,E=vs,r=Ts;return B(),L("section",null,[u("div",zs,[(B(!0),L(Ds,null,Cs(Object.keys(i),e=>(B(),ms(n,{key:e,class:es([e==="reset"?"bg-#F56C6C":"bg-#f8b200",{"!bg-#6dd230":a.actives.has(e)}]),disabled:a.actives.has(e)||e==="reset"&&!a.modified,onClick:g=>h.onClick(e)},{default:ts(()=>[M(bs(i[e]),1)]),_:2},1032,["class","disabled","onClick"]))),128)),u("div",null,[Y(E,{modelValue:a.symbol,"onUpdate:modelValue":p[0]||(p[0]=e=>a.symbol=e),onOnChange:h.changeSymbol},null,8,["modelValue","onOnChange"])])]),Y(r,{loading:a.loading,class:"rd-10px overflow-hidden"},{default:ts(()=>[u("div",{ref:e=>a.el=e,class:"bg-#409EFF/10 h-300px rd-10px"},null,512)]),_:1},8,["loading"])])}}}),js=JSON.parse('{"title":"深度图","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"npm/depth.md","filePath":"npm/depth.md","lastUpdated":1721378222000}'),Ws={name:"npm/depth.md"},Hs=u("h1",{id:"深度图",tabindex:"-1"},[M("深度图 "),u("a",{class:"header-anchor",href:"#深度图","aria-label":'Permalink to "深度图"'},"​")],-1),Xs=u("h2",{id:"demo",tabindex:"-1"},[M("Demo "),u("a",{class:"header-anchor",href:"#demo","aria-label":'Permalink to "Demo"'},"​")],-1),Ns=fs("",52);function Rs(k,i,s,t,a,h){const l=$s;return B(),L("div",null,[Hs,Xs,Y(l),Ns])}const Us=Bs(Ws,[["render",Rs]]);export{js as __pageData,Us as default};
