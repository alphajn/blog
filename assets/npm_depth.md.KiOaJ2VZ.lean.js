var ds=Object.defineProperty;var Es=(k,s,i)=>s in k?ds(k,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):k[s]=i;var d=(k,s,i)=>Es(k,typeof s!="symbol"?s+"":s,i);import{d as ks,h as gs,c as S,o as B,e as ys,r as os,n as es,j as u,N as cs,u as Fs,D as As,ah as us,v as Ds,$ as Cs,q as as,G as M,F as ms,B as bs,b as Bs,w as ts,a as O,t as fs,_ as vs,ag as xs}from"./chunks/framework.Cghu_Lar.js";import{_ as ws}from"./chunks/Symbol.vue_vue_type_script_setup_true_lang.Bue2XAXr.js";import{_ as qs}from"./chunks/Button.D-t11-Ky.js";import{f as w,a as y,y as V,N as ns,c as q,d as F,s as Y,x as P,u as T,S as hs}from"./chunks/index.B8mzIwg2.js";import{f as Ps,w as Ts}from"./chunks/config.CIuV0BFT.js";import"./chunks/Select.CZYNvlzA.js";const Ls={class:"relative"},Ss=ks({__name:"Loading",props:{loading:{type:Boolean,default:!1},size:{type:String,default:""},color:{type:String,default:"#E6A23C"}},setup(k){const s=k,i=gs(()=>({"text-72px":s.size==="big","text-46px":s.size==="","text-24px":s.size==="small","text-14px":s.size==="mini"}));return(t,a)=>(B(),S("div",Ls,[k.loading?(B(),S("div",{key:0,class:es(["absolute grid grid-place-content-center inset-0 bg-#000/5 cursor-progress z-1",i.value])},[u("span",{class:"i-svg-spinners:tadpole block",style:cs({color:k.color})},null,4)],2)):ys("",!0),os(t.$slots,"default")]))}});function ls(k="dark"){const s=k==="light";return{grid:{top:0,bottom:50,gap:4,position:"left"},buy:"#19bf86",sell:"#f8495e",lineWidth:2,buyGradient:["rgba(25, 191, 134, 0)","rgba(25, 191, 134, 0.2)"],sellGradient:["rgba(248, 73, 94, 0)","rgba(248, 73, 94, 0.2)"],tooltip:{padding:10,size:20,color:s?"black":"white",bg:s?"#fff":"#16171A",maskColor:"rgba(0, 0, 0, 0.02)"},separator:{size:2,color:s?"black":"white"},axis:{size:20,color:s?"black":"white",lineColor:s?"black":"white"}}}function ps(k){const s=[];return k.forEach((i,t)=>{let a=i[1];t>0&&(a=F(a,s[t-1].total)),s.push({price:String(i[0]),quantity:String(i[1]),total:String(a)})}),s}function $(k,s,i,t,a,h=!1){k.beginPath(),k.lineWidth=s,k.strokeStyle=i,h&&k.setLineDash([6,6]),k.moveTo(t[0],t[1]),k.lineTo(a[0],a[1]),k.stroke(),k.closePath()}function b(k,s,i,t,a=8){k.beginPath(),k.fillStyle=t,k.arc(s,i,a,0,2*Math.PI,!0),k.fill(),k.closePath()}function W(k,s,i,t,a,h,l=20,p=8){k.beginPath(),k.fillStyle=s,l&&(k.shadowBlur=l,k.shadowColor="rgba(0, 0, 0, 0.2)"),k.roundRect(i,t,a,h,p),k.fill(),k.closePath()}const L=(k,s)=>k.measureText(s).width||0;class _s{constructor(s,i){d(this,"el");d(this,"ready",!1);d(this,"canvas",null);d(this,"tooltip",null);d(this,"ratio",2);d(this,"ctx",null);d(this,"tooltipCtx",null);d(this,"pricePrecision",2);d(this,"quantityPrecision",4);d(this,"style",ls());d(this,"middle",0);d(this,"max","");d(this,"cW",0);d(this,"cH",0);d(this,"xTickWidth",120);d(this,"left",120);d(this,"buyList",[]);d(this,"sellList",[]);d(this,"lastPrice","0");d(this,"requestAnimation",0);d(this,"showTooltip",!1);d(this,"tooltipAnimation",0);d(this,"clientX",0);d(this,"clientY",0);d(this,"texts",{buy:"Buy",sell:"Sell"});if(typeof s=="string"?this.el=document.querySelector(s):this.el=s,!this.el)throw new Error("el 获取出错~!~");i!=null&&i.theme&&this.setTheme(i.theme,!1),i!=null&&i.style&&this.setStyle(i.style,!1),this.init()}init(){const s=this.el.querySelectorAll("canvas");s!=null&&s.length&&s.forEach(i=>{this.el.removeChild(i)}),this.el.style.position="relative",this.canvas=document.createElement("canvas"),this.el.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.tooltip=document.createElement("canvas"),this.el.appendChild(this.tooltip),this.tooltipCtx=this.tooltip.getContext("2d"),this.tooltip.style.position="absolute",this.tooltip.style.left="0",this.tooltip.style.top="0",this.resizeObserver(),this.listenMove()}resizeObserver(){new ResizeObserver(()=>{this.resize()}).observe(this.el)}setData(s,i){this.requestAnimation&&cancelAnimationFrame(this.requestAnimation),this.requestAnimation=requestAnimationFrame(()=>{const t=Math.min(s.length,i.length),a=s.slice(0,t).sort((l,p)=>Number(w(p[0],l[0]))),h=i.slice(0,t).sort((l,p)=>Number(w(l[0],p[0])));this.buyList=ps(a).reverse(),this.sellList=ps(h),this.ready&&this.updateDraw()})}draw(){if(!this.canvas||!this.ctx)return;const{ctx:s,style:i}=this;if(s.clearRect(0,0,this.canvas.width,this.canvas.height),!this.buyList.length)return;s.font=`${i.axis.size}px Verdana, Arial, Helvetica, sans-serif`,this.max=y(V(this.buyList[0].total,this.sellList.slice(-1)[0].total),1.35);const t=this.getTickPrecision(),a=this.getXTickList(t);this.xTickWidth=Number(V(...a.map(l=>L(s,`${ns(l,t)} -`)+18))),this.left=this.style.grid.position==="right"?0:this.xTickWidth,this.cW=this.canvas.width-this.xTickWidth-i.grid.gap*2-i.separator.size,this.middle=(this.canvas.width-this.xTickWidth)/2;const h=q(this.cW,2*this.buyList.length);this.drawBuy(h),this.drawSell(h),this.drawGrid(),this.drawXTick(a,t),this.drawYTick()}drawBuy(s){const{ctx:i,style:t}=this,a=this.left+t.lineWidth/2;i&&(i.beginPath(),i.moveTo(a,this.cH),i.strokeStyle=t.buy,i.lineWidth=t.lineWidth,this.buyList.forEach((h,l)=>{const p=F(a,y(s,l)),n=Number(F(p,s)),E=this.matchX(this.buyList[l].total);i.lineTo(Number(p),E),i.lineTo(n,E),l===this.buyList.length-1&&i.lineTo(n,this.cH)}),i.stroke(),this.drawArea(a,a,t.buyGradient),i.closePath())}drawSell(s){const{ctx:i,style:t}=this,a=F(this.middle,this.left),h=Number(F(a,t.grid.gap));i&&(i.beginPath(),i.moveTo(h,this.cH),i.strokeStyle=t.sell,i.lineWidth=t.lineWidth,this.sellList.forEach((l,p)=>{const n=F(h,y(s,p)),E=Number(F(n,s)),r=this.matchX(this.sellList[p].total);i.lineTo(Number(n),r),i.lineTo(E,r),p===this.sellList.length-1&&i.lineTo(E,this.cH)}),i.stroke(),this.drawArea(h,h,t.sellGradient),i.closePath())}drawGrid(){const{ctx:s,style:i}=this,{top:t}=i.grid;if(!s||!this.canvas)return;const a=this.left+i.lineWidth/2;let h=a;const l=i.grid.position==="right";l&&(h=this.canvas.width-this.xTickWidth),[{color:i.axis.lineColor,width:i.lineWidth,from:[h,this.cH],to:[h,t]},{color:i.separator.color,width:i.separator.size,from:[this.middle+this.left,this.cH],to:[this.middle+this.left,t]},{color:i.axis.lineColor,width:i.lineWidth,from:[a,this.cH],to:[l?h:this.canvas.width,this.cH]}].forEach(p=>{$(s,p.width,p.color,p.from,p.to)})}getXTickList(s){const i=Y(q(this.max,6),s+2,0);let t=1;const a=[];for(;t<6;){const h=y(i,t);a.push(h),t+=1}return a}drawXTick(s,i){const{ctx:t,canvas:a,style:h,xTickWidth:l}=this;if(!t||!a)return;const p=h.grid.position==="right",n=p?a.width-l:l;t.fillStyle=h.axis.color,t.textAlign=p?"left":"right",s.forEach(E=>{const r=this.matchX(E),e=ns(E,i),g=p?`- ${e}`:`${e} -`;t.fillText(g,n,r)})}drawYTick(s=!1){const{ctx:i,canvas:t,style:a,left:h}=this;if(!i||!t||!this.buyList.length)return;const l=this.middle/2,p=a.lineWidth/2;let n=[{x:h+p,side:"buy",align:"left"},{x:l+h,side:"buy",align:"center"},{x:this.middle+h,price:P(this.lastPrice,0)?this.lastPrice:this.buyList.slice(-1)[0].price,side:"buy",align:"center"},{x:l*3+h,side:"sell",align:"center"},{x:t.width-(a.grid.position==="right"?this.xTickWidth:p),side:"sell",align:"right"}];i.fillStyle=a.axis.color;const E=L(i,T(this.sellList[0].price,this.pricePrecision));s?(n=n.filter((r,e)=>e===2),i.clearRect(this.middle+h-E/2,this.cH+12,E,a.axis.size)):(E*1.7>this.cW/4||this.buyList.length<2)&&(n=n.filter((r,e)=>![1,3].includes(e))),n.forEach(r=>{var o,A;const e=this.matchY(r.x,r.side);let g=r.price||"0.00";i.textAlign=r.align,!r.price&&e>=0&&(g=r.side==="buy"?(o=this.buyList[e])==null?void 0:o.price:(A=this.sellList[e])==null?void 0:A.price),i.fillText(`${T(g||"0.00",this.pricePrecision)}`,r.x,this.cH+10+a.axis.size),$(i,2,a.axis.lineColor,[r.x,this.cH+2],[r.x,this.cH+10])})}drawArea(s,i,t){if(this.ctx){const a=this.ctx.createLinearGradient(s,this.cH,i,170);a.addColorStop(1,t[1]),a.addColorStop(0,t[0]),this.ctx.fillStyle=a,this.ctx.fill()}}drawTooltip(){const{tooltip:s,tooltipAnimation:i,tooltipCtx:t,showTooltip:a,clientX:h,clientY:l,middle:p,style:n,left:E,buyList:r,sellList:e,quantityPrecision:g,texts:o,xTickWidth:A}=this;i&&cancelAnimationFrame(i),this.tooltipAnimation=requestAnimationFrame(()=>{if(!t||!s||(t.clearRect(0,0,s.width,s.height),!a))return;const c=h<p+E-n.grid.gap,f=h>p+E+n.grid.gap,v=this.matchY(h,c?"buy":"sell");if(!c&&!f||!r[v])return;t.font=`${n.tooltip.size}px Verdana, Arial, Helvetica, sans-serif`;const D=8,_=c?r[v]:r[r.length-v-1],z=f?e[v]:e[r.length-v-1];let H="0.00";const X=`${o.buy}: ${T(_.total,g)}`,N=`${o.sell}: ${T(z.total,g)}`,rs=V(L(t,X),L(t,N)),I=Number(F(F(rs,n.tooltip.padding*2),D*2+10)),R=n.tooltip.padding*2+n.tooltip.size*3+24,j=c?this.clientX+20:this.clientX-I-20,U=l>this.cH-R-n.lineWidth?this.cH-R-n.lineWidth:l,J=n.grid.position==="left"?A:-A,C=c?h:s.width-h+J,m=f?h:s.width-h+J,K=this.matchX(_.total),Q=this.matchX(z.total);c&&(H=Y(y(q(hs(w(_.price,this.lastPrice)),this.lastPrice),100),2)),f&&(H=Y(y(q(hs(w(z.price,this.lastPrice)),this.lastPrice),100),2)),b(t,C,K,n.buyGradient[1],12),b(t,C,K,n.buy),$(t,n.lineWidth,n.buy,[C,n.grid.top],[C,this.cH+10],!0),W(t,n.tooltip.maskColor,E,n.grid.top,C-E,this.cH,0,0),this.drawPriceRect(C,_.price),b(t,m,Q,n.sellGradient[1],12),b(t,m,Q,n.sell),$(t,n.lineWidth,n.sell,[m,n.grid.top],[m,this.cH+10],!0),W(t,n.tooltip.maskColor,m,n.grid.top,C-E,this.cH,0,0),this.drawPriceRect(m,z.price),W(t,n.tooltip.bg,j,U,I,R);const Z=U+n.tooltip.padding+n.tooltip.size/2,G=Z+n.tooltip.size+12,ss=G+n.tooltip.size+12,x=j+n.tooltip.padding,is=c?n.buy:n.sell;t.textAlign="left",t.textBaseline="middle",t.fillStyle=is,t.fillText(`${H}%`,x,Z),b(t,x+D,G-1,is,D),t.fillStyle=n.tooltip.color,t.fillText(c?X:N,x+D*2+10,G),b(t,x+D,ss-1,f?n.buy:n.sell,D),t.fillStyle=n.tooltip.color,t.fillText(c?N:X,x+D*2+10,ss)})}drawPriceRect(s,i){if(!this.tooltipCtx||!this.tooltip)return;const t=T(i,this.pricePrecision),a=L(this.tooltipCtx,t)+10;let h=s-a/2;const l=this.style.axis.size+8,p=this.tooltip.width-a/2,n=this.style.grid.position==="right";h<this.left?h=this.left:s>(n?p-this.xTickWidth:p)&&(h=this.tooltip.width-a,n&&(h-=this.xTickWidth)),W(this.tooltipCtx,"rgb(76, 82, 94)",h,this.cH+10,a,l,0,4),this.tooltipCtx.fillStyle="#fff",this.tooltipCtx.fillText(t,h+5,this.cH+10+l/2)}matchY(s,i){const{gap:t}=this.style.grid,a=this.left+this.middle+t+this.style.separator.size,h=i==="sell"?a:this.left;return Math.floor((s-h)*this.buyList.length/(this.cW/2))}matchX(s){const i=y(q(s,this.max),this.cH);return Math.round(Number(w(this.cH,i)))}updateDraw(){this.draw(),this.showTooltip&&this.drawTooltip()}getTickPrecision(){let s=this.quantityPrecision;return P(this.max,1e3)?s=2:P(this.max,10)?s=0:P(this.max,1)?s=1:P(this.max,.1)&&(s=2),s}listenMove(){this.tooltip&&(this.tooltip.addEventListener("mousemove",this.mousemove.bind(this),!1),this.tooltip.addEventListener("mouseout",this.mouseout.bind(this),!1))}mousemove(s){if(!this.tooltip)return;this.clientX=s.offsetX*this.ratio,this.clientY=s.offsetY*this.ratio;const i=this.style.grid.position==="right"?this.tooltip.width-this.xTickWidth:this.tooltip.width;this.showTooltip=this.clientX>this.left&&this.clientX<i,this.drawTooltip()}mouseout(){this.showTooltip=!1,this.clientX=0,this.clientY=0,this.drawTooltip()}updateLastPrice(s){this.lastPrice=s,this.drawYTick(!0)}setPrecision(s=2,i=4){this.pricePrecision=s,this.quantityPrecision=i,this.buyList.length&&this.updateDraw()}setTheme(s,i=!0){this.style=ls(s||"dark"),i&&this.updateDraw()}getStyle(){return this.style}setStyle(s,i=!0){this.style={...this.style,...s},i&&this.updateDraw()}resize(){if(this.ready=!0,this.canvas){const{width:s,height:i}=this.el.getBoundingClientRect();[this.canvas,this.tooltip].forEach(t=>{t&&(t.style.width=`${s}px`,t.style.height=`${i}px`,t.width=s*this.ratio,t.height=i*this.ratio)}),this.cH=this.canvas.height-this.style.grid.bottom}this.buyList.length&&this.updateDraw()}setLang(s){this.texts=s,this.drawTooltip()}}const zs={class:"flex flex-row flex-wrap mb-12px gap-10px"},$s=ks({__name:"Depth",setup(k){const s={theme:"修改主题",big:"大数样式",precision:"高精度",changeText:"更新tooltip文本",reset:"重置"},{isDark:i}=Fs(),t=As(null),a=us({el:null,chart:null,loading:!1,actives:new Set,buys:[],sells:[],modified:!1,symbol:"BTCUSDT",symbols:{}}),h={init(){a.modified=!1,a.actives=new Set,a.chart=new _s(a.el,{theme:i.value?"dark":"light"}),h.send()},send(){var l;a.loading=!0,(l=t.value)==null||l.send({event:"sub",topic:"depth",symbol:a.symbol,id:`sub_depth_${a.symbol}`},p=>{var n,E,r,e;a.loading&&((n=a.chart)==null||n.updateLastPrice("0"),(E=a.chart)==null||E.setPrecision(a.symbols.priceDecimal,a.symbols.qtyDecimal),(r=t.value)==null||r.send({event:"sub",topic:"realtimes",symbol:a.symbol,id:`sub_realtimes_${a.symbol}`},g=>{var A;const o=((g==null?void 0:g.data)||[]).slice(-1);o.length&&((A=a.chart)==null||A.updateLastPrice(a.actives.has("big")?y(o[0].c,1e4):o[0].c))})),a.loading=!1,a.sells=a.actives.has("big")?h.format3big(p.data[0].a):p.data[0].a,a.buys=a.actives.has("big")?h.format3big(p.data[0].b):p.data[0].b,(e=a.chart)==null||e.setData(a.buys,a.sells)})},unSend(l){var p,n;(p=t.value)==null||p.send({event:"cancel",topic:"depth",symbol:l||a.symbol,id:`sub_depth_${l||a.symbol}`},()=>{}),(n=t.value)==null||n.send({event:"cancel",topic:"realtimes",symbol:l||a.symbol,id:`sub_realtimes_${l||a.symbol}`},()=>{})},changeStyle(){var l;(l=a.chart)==null||l.setStyle({buy:"#67C23A",sell:"#F56C6C",buyGradient:["rgba(32, 178, 108, 0.01)","#67C23A"],sellGradient:["rgba(239, 69, 74, 0.01)","#F56C6C"],grid:{position:"right",top:0,bottom:50,gap:4},separator:{size:2,color:"#E6A23C"},axis:{size:20,color:"#E6A23C",lineColor:"#409EFF"}})},onClick(l){var p,n;if(!a.actives.has(l)){switch(l){case"reset":h.unSend(),h.init();break;case"theme":h.changeStyle();break;case"precision":(p=a.chart)==null||p.setPrecision(10,10);break;case"changeText":(n=a.chart)==null||n.setLang({buy:"买呀",sell:"卖呀"});break}l!=="reset"?(a.modified=!0,a.actives.add(l)):a.modified=!1}},format3big(l){return l.map(p=>[y(p[0],1e4),y(p[1],1e10)])},changeSymbol(l){a.symbols=l}};return Ds(()=>{t.value=new Ps(Ts,{heart:!0}),h.init()}),Cs(()=>{h.unSend()}),as(()=>i.value,l=>{var p;a.actives.has("theme")&&a.actives.delete("theme"),(p=a.chart)==null||p.setTheme(l?"dark":"light")},{immediate:!0}),as(()=>a.symbol,(l,p)=>{h.unSend(p),h.send()}),(l,p)=>{const n=qs,E=ws,r=Ss;return B(),S("section",null,[u("div",zs,[(B(!0),S(ms,null,bs(Object.keys(s),e=>(B(),Bs(n,{key:e,class:es([e==="reset"?"bg-#F56C6C":"bg-#f8b200",{"!bg-#6dd230":a.actives.has(e)}]),disabled:a.actives.has(e)||e==="reset"&&!a.modified,onClick:g=>h.onClick(e)},{default:ts(()=>[O(fs(s[e]),1)]),_:2},1032,["class","disabled","onClick"]))),128)),u("div",null,[M(E,{modelValue:a.symbol,"onUpdate:modelValue":p[0]||(p[0]=e=>a.symbol=e),onOnChange:h.changeSymbol},null,8,["modelValue","onOnChange"])])]),M(r,{loading:a.loading,class:"rd-10px overflow-hidden"},{default:ts(()=>[u("div",{ref:e=>a.el=e,class:"bg-#409EFF/10 h-300px rd-10px"},null,512)]),_:1},8,["loading"])])}}}),Os=JSON.parse('{"title":"深度图","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"npm/depth.md","filePath":"npm/depth.md","lastUpdated":1721378222000}'),Ws={name:"npm/depth.md"};function Hs(k,s,i,t,a,h){const l=$s;return B(),S("div",null,[s[0]||(s[0]=u("h1",{id:"深度图",tabindex:"-1"},[O("深度图 "),u("a",{class:"header-anchor",href:"#深度图","aria-label":'Permalink to "深度图"'},"​")],-1)),s[1]||(s[1]=u("h2",{id:"demo",tabindex:"-1"},[O("Demo "),u("a",{class:"header-anchor",href:"#demo","aria-label":'Permalink to "Demo"'},"​")],-1)),M(l),s[2]||(s[2]=xs("",52))])}const Is=vs(Ws,[["render",Hs]]);export{Os as __pageData,Is as default};
