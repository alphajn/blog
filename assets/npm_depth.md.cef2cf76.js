import"./chunks/index.1b63ebcc.js";import{u as ht,l as ot}from"./chunks/index.6875bed8.js";import"./chunks/el-loading.4ed993c7.js";import{d as at,a5 as rt,u as nt,q as ct,w as dt,a6 as pt,o as st,c as et,_ as ut,J as mt,C as w,a as R}from"./chunks/framework.8e4fecd6.js";import{p as L,l as y,y as Q,N as B,w as W,a as u,m as G,f as $,s as S,S as Z}from"./chunks/index.7e71f9e5.js";import"./chunks/index.dcfd59dc.js";import"./chunks/index.4e037dc3.js";const tt=(o="dark")=>{const t=o==="light";return{grid:{top:0,bottom:50,gap:4,poition:"left"},buy:"#20b26c",sell:"#ef454a",lineWidth:2,buyGradient:["rgba(32, 178, 108, 0)","rgba(32, 178, 108, 0.2)"],sellGradient:["rgba(239, 69, 74, 0)","rgba(239, 69, 74, 0.2)"],tooltip:{padding:10,size:20,color:t?"black":"white",bg:t?"#fff":"#16171A",maskColor:"rgba(0, 0, 0, 0.02)"},separator:{size:2,color:t?"black":"white"},axis:{size:20,color:t?"black":"white",lineColor:t?"black":"white"}}},it=o=>{const t=[];return o.forEach((i,s)=>{let e=i[1];s>0&&(e=u(e,t[s-1].total)),t.push({price:String(i[0]),quantity:String(i[1]),total:String(e)})}),t},z=(o,t,i,s,e,h=!1)=>{o.beginPath(),o.lineWidth=t,o.strokeStyle=i,h&&o.setLineDash([6,6]),o.moveTo(s[0],s[1]),o.lineTo(e[0],e[1]),o.stroke(),o.closePath()},b=(o,t,i,s,e=8)=>{o.beginPath(),o.fillStyle=s,o.arc(t,i,e,0,2*Math.PI,!0),o.fill(),o.closePath()},D=(o,t,i,s,e,h,r=20,a=8)=>{o.beginPath(),o.fillStyle=t,r&&(o.shadowBlur=r,o.shadowColor="rgba(0, 0, 0, 0.2)"),o.roundRect(i,s,e,h,a),o.fill(),o.closePath()},C=(o,t)=>o.measureText(t).width||0;class gt{constructor(t,i){if(this.ready=!1,this.canvas=null,this.tooltip=null,this.ratio=2,this.ctx=null,this.tooltipCtx=null,this.pricePrecision=2,this.quantityPrecision=4,this.style=tt(),this.middle=0,this.max="",this.cW=0,this.cH=0,this.xTickWidth=120,this.left=120,this.buyList=[],this.sellList=[],this.lastPrice="0",this.requestAnimation=0,this.showTooltip=!1,this.tooltipAnimation=0,this.clientX=0,this.clientY=0,this.texts={buy:"Buy",sell:"Sell"},typeof t=="string"?this.el=document.querySelector(t):this.el=t,!this.el)throw new Error("el 获取出错~!~");i!=null&&i.theme&&this.setTheme(i.theme,!1),i!=null&&i.style&&this.setStyle(i.style,!1),this.init()}init(){const t=this.el.querySelectorAll("canvas");t!=null&&t.length&&t.forEach(i=>{this.el.removeChild(i)}),this.el.style.position="relative",this.canvas=document.createElement("canvas"),this.el.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.tooltip=document.createElement("canvas"),this.el.appendChild(this.tooltip),this.tooltipCtx=this.tooltip.getContext("2d"),this.tooltip.style.position="absolute",this.tooltip.style.left="0",this.tooltip.style.top="0",this.resizeObserver(),this.listenMove()}resizeObserver(){new ResizeObserver(()=>{this.resize()}).observe(this.el)}setData(t,i){this.requestAnimation&&cancelAnimationFrame(this.requestAnimation),this.requestAnimation=requestAnimationFrame(()=>{const s=Math.min(t.length,i.length),e=t.slice(0,s).sort((r,a)=>Number(L(a[0],r[0]))),h=i.slice(0,s).sort((r,a)=>Number(L(r[0],a[0])));this.buyList=it(e).reverse(),this.sellList=it(h),this.ready&&this.updateDraw()})}draw(){if(!this.canvas||!this.ctx)return;const{ctx:t,style:i}=this;if(t.clearRect(0,0,this.canvas.width,this.canvas.height),!this.buyList.length)return;t.font=`${i.axis.size}px Verdana, Arial, Helvetica, sans-serif`,this.max=y(Q(this.buyList[0].total,this.sellList.slice(-1)[0].total),1.4);const s=this.getTickPrecision();this.xTickWidth=C(t,`${B(this.max,s)} -`)+18,this.left=this.style.grid.poition==="right"?0:this.xTickWidth,this.cW=this.canvas.width-this.xTickWidth-i.grid.gap*2-i.separator.size,this.middle=(this.canvas.width-this.xTickWidth)/2;const e=W(this.cW,2*this.buyList.length);this.drawBuy(e),this.drawSell(e),this.drawGrid(),this.drawXTick(s),this.drawYTick()}drawBuy(t){const{ctx:i,style:s}=this,e=this.left+s.lineWidth/2;i&&(i.beginPath(),i.moveTo(e,this.cH),i.strokeStyle=s.buy,i.lineWidth=s.lineWidth,this.buyList.forEach((h,r)=>{const a=u(e,y(t,r)),l=Number(u(a,t)),c=this.matchX(this.buyList[r].total);i.lineTo(Number(a),c),i.lineTo(l,c),r===this.buyList.length-1&&i.lineTo(l,this.cH)}),i.stroke(),this.drawArea(e,e,s.buyGradient),i.closePath())}drawSell(t){const{ctx:i,style:s}=this,e=u(this.middle,this.left),h=Number(u(e,s.grid.gap));i&&(i.beginPath(),i.moveTo(h,this.cH),i.strokeStyle=s.sell,i.lineWidth=s.lineWidth,this.sellList.forEach((r,a)=>{const l=u(h,y(t,a)),c=Number(u(l,t)),n=this.matchX(this.sellList[a].total);i.lineTo(Number(l),n),i.lineTo(c,n),a===this.sellList.length-1&&i.lineTo(c,this.cH)}),i.stroke(),this.drawArea(h,h,s.sellGradient),i.closePath())}drawGrid(){const{ctx:t,style:i}=this,{top:s}=i.grid;if(!t||!this.canvas)return;const e=this.left+i.lineWidth/2;let h=e;const r=i.grid.poition==="right";r&&(h=this.canvas.width-this.xTickWidth),[{color:i.axis.lineColor,width:i.lineWidth,from:[h,this.cH],to:[h,s]},{color:i.separator.color,width:i.separator.size,from:[this.middle+this.left,this.cH],to:[this.middle+this.left,s]},{color:i.axis.lineColor,width:i.lineWidth,from:[e,this.cH],to:[r?h:this.canvas.width,this.cH]}].forEach(a=>{z(t,a.width,a.color,a.from,a.to)})}drawXTick(t){const{ctx:i,canvas:s,style:e,xTickWidth:h}=this;if(!i||!s)return;const r=G(W(this.max,6),t),a=e.grid.poition==="right",l=a?s.width-h:h;let c=1;for(i.fillStyle=e.axis.color,i.textAlign=a?"left":"right";c<6;){const n=y(r,c),d=this.matchX(n),m=a?`- ${B(n,t)}`:`${B(n,t)} -`;i.fillText(m,l,d),c+=1}}drawYTick(t=!1){const{ctx:i,canvas:s,style:e,left:h}=this;if(!i||!s||!this.buyList.length)return;const r=this.middle/2,a=e.lineWidth/2;let l=[{x:h+a,side:"buy",align:"left"},{x:r+h,side:"buy",align:"center"},{x:this.middle+h,price:$(this.lastPrice,0)?this.lastPrice:this.buyList.slice(-1)[0].price,side:"buy",align:"center"},{x:r*3+h,side:"sell",align:"center"},{x:s.width-(e.grid.poition==="right"?this.xTickWidth:a),side:"sell",align:"right"}];i.fillStyle=e.axis.color;const c=C(i,S(this.sellList[0].price,this.pricePrecision));t?(l=l.filter((n,d)=>d===2),i.clearRect(this.middle+h-c/2,this.cH+12,c,e.axis.size)):(c*1.7>this.cW/4||this.buyList.length<2)&&(l=l.filter((n,d)=>![1,3].includes(d))),l.forEach(n=>{var T,v;const d=this.matchY(n.x,n.side);let m=n.price||"0.00";i.textAlign=n.align,!n.price&&d>=0&&(m=n.side==="buy"?(T=this.buyList[d])==null?void 0:T.price:(v=this.sellList[d])==null?void 0:v.price),i.fillText(`${S(m||"0.00",this.pricePrecision)}`,n.x,this.cH+10+e.axis.size),z(i,2,e.axis.lineColor,[n.x,this.cH+2],[n.x,this.cH+10])})}drawArea(t,i,s){if(this.ctx){const e=this.ctx.createLinearGradient(t,this.cH,i,170);e.addColorStop(1,s[1]),e.addColorStop(0,s[0]),this.ctx.fillStyle=e,this.ctx.fill()}}drawTooltip(){const{tooltip:t,tooltipAnimation:i,tooltipCtx:s,showTooltip:e,clientX:h,clientY:r,middle:a,style:l,left:c,buyList:n,sellList:d,quantityPrecision:m,texts:T,xTickWidth:v}=this;i&&cancelAnimationFrame(i),this.tooltipAnimation=requestAnimationFrame(()=>{if(!s||!t||(s.clearRect(0,0,t.width,t.height),!e))return;const p=h<a+c-l.grid.gap,k=h>a+c+l.grid.gap,P=this.matchY(h,p?"buy":"sell");if(!p&&!k||!n[P])return;s.font=`${l.tooltip.size}px Verdana, Arial, Helvetica, sans-serif`;const g=8,H=p?n[P]:n[n.length-P-1],A=k?d[P]:d[n.length-P-1];let X="0.00";const q=`${T.buy}: ${S(H.quantity,m)}`,E=`${T.sell}: ${S(A.quantity,m)}`,lt=Q(C(s,q),C(s,E)),M=Number(u(u(lt,l.tooltip.padding*2),g*2+10)),N=l.tooltip.padding*2+l.tooltip.size*3+24,F=p?this.clientX+20:this.clientX-M-20,V=r>this.cH-N-l.lineWidth?this.cH-N-l.lineWidth:r,O=l.grid.poition==="left"?v:-v,f=p?h:t.width-h+O,x=k?h:t.width-h+O,I=this.matchX(H.total),J=this.matchX(A.total);p&&(X=G(y(W(Z(L(H.price,this.lastPrice)),this.lastPrice),100),2)),k&&(X=G(y(W(Z(L(A.price,this.lastPrice)),this.lastPrice),100),2)),b(s,f,I,l.buyGradient[1],12),b(s,f,I,l.buy),z(s,l.lineWidth,l.buy,[f,l.grid.top],[f,this.cH+10],!0),D(s,l.tooltip.maskColor,c,l.grid.top,f-c,this.cH,0,0),this.drawPriceRect(f,H.price),b(s,x,J,l.sellGradient[1],12),b(s,x,J,l.sell),z(s,l.lineWidth,l.sell,[x,l.grid.top],[x,this.cH+10],!0),D(s,l.tooltip.maskColor,x,l.grid.top,f-c,this.cH,0,0),this.drawPriceRect(x,A.price),D(s,l.tooltip.bg,F,V,M,N);const U=V+l.tooltip.padding+l.tooltip.size/2,Y=U+l.tooltip.size+12,j=Y+l.tooltip.size+12,_=F+l.tooltip.padding,K=p?l.buy:l.sell;s.textAlign="left",s.textBaseline="middle",s.fillStyle=K,s.fillText(`${X}%`,_,U),b(s,_+g,Y-1,K,g),s.fillStyle=l.tooltip.color,s.fillText(p?q:E,_+g*2+10,Y),b(s,_+g,j-1,k?l.buy:l.sell,g),s.fillStyle=l.tooltip.color,s.fillText(p?E:q,_+g*2+10,j)})}drawPriceRect(t,i){if(!this.tooltipCtx||!this.tooltip)return;const s=S(i,this.pricePrecision),e=C(this.tooltipCtx,s)+10;let h=t-e/2;const r=this.style.axis.size+8,a=this.tooltip.width-e/2,l=this.style.grid.poition==="right";h<this.left?h=this.left:t>(l?a-this.xTickWidth:a)&&(h=this.tooltip.width-e,l&&(h-=this.xTickWidth)),D(this.tooltipCtx,"rgb(76, 82, 94)",h,this.cH+10,e,r,0,4),this.tooltipCtx.fillStyle="#fff",this.tooltipCtx.fillText(s,h+5,this.cH+10+r/2)}matchY(t,i){const{gap:s}=this.style.grid,e=this.left+this.middle+s+this.style.separator.size,h=i==="sell"?e:this.left;return Math.floor((t-h)*this.buyList.length/(this.cW/2))}matchX(t){const i=y(W(t,this.max),this.cH);return Math.round(Number(L(this.cH,i)))}updateDraw(){this.draw(),this.showTooltip&&this.drawTooltip()}getTickPrecision(){let t=this.quantityPrecision;return $(this.max,1e3)?t=2:$(this.max,10)?t=0:$(this.max,1)?t=1:$(this.max,.1)&&(t=2),t}listenMove(){this.tooltip&&(this.tooltip.addEventListener("mousemove",this.mousemove.bind(this),!1),this.tooltip.addEventListener("mouseout",this.mouseout.bind(this),!1))}mousemove(t){if(!this.tooltip)return;this.clientX=t.offsetX*this.ratio,this.clientY=t.offsetY*this.ratio;const i=this.style.grid.poition==="right"?this.tooltip.width-this.xTickWidth:this.tooltip.width;this.showTooltip=this.clientX>this.left&&this.clientX<i,this.drawTooltip()}mouseout(){this.showTooltip=!1,this.clientX=0,this.clientY=0,this.drawTooltip()}updateLastPrice(t){this.lastPrice=t,this.drawYTick(!0)}setPrecision(t=2,i=4){this.pricePrecision=t,this.quantityPrecision=i,this.buyList.length&&this.updateDraw()}setTheme(t,i=!0){this.style=tt(t||"dark"),i&&this.updateDraw()}getStyle(){return this.style}setStyle(t,i=!0){this.style={...this.style,...t},i&&this.updateDraw()}resize(){if(this.ready=!0,this.canvas){const{width:t,height:i}=this.el.getBoundingClientRect();[this.canvas,this.tooltip].forEach(s=>{s&&(s.style.width=`${t}px`,s.style.height=`${i}px`,s.width=t*this.ratio,s.height=i*this.ratio)}),this.cH=this.canvas.height-this.style.grid.bottom}this.buyList.length&&this.updateDraw()}setLang(t){this.texts=t,this.drawTooltip()}}const ft=(o,t)=>new gt(o,t),yt=at({__name:"Depth",setup(o){const t=rt({ref:null,chart:null,buys:[[200000.69,1000.0004],[300000.72,2000.0006],[400000.3,60.999]],sells:[[200001.6329,1000.0004],[300001.72,200.0006],[400001.3,60.999]],loading:!0}),i=new ht("wss://ws.meex.com/kline-api/ws"),{isDark:s}=nt();return i.send({event:"sub",params:{channel:"market_btcusdt_depth_step0"}},e=>{t.loading=!1,e.success&&(t.sells=e.tick.asks,t.buys=e.tick.buys,t.chart&&t.chart.setData(t.buys,t.sells))}),ct(()=>{t.chart=ft(t.ref,{theme:"light",style:{}}),t.buys.length&&t.chart.setData(t.buys,t.sells)}),dt(()=>s.value,e=>{t.chart&&t.chart.setTheme(e?"dark":"light")},{immediate:!0}),(e,h)=>{const r=ot.ElLoadingDirective;return pt((st(),et("div",{ref:a=>t.ref=a,class:"bg-gray-400/10 h-300px"},null,512)),[[r,t.loading]])}}}),Ct=JSON.parse('{"title":"深度图","description":"","frontmatter":{},"headers":[],"relativePath":"npm/depth.md","lastUpdated":1686190063000}'),xt={name:"npm/depth.md"},bt=w("h1",{id:"深度图",tabindex:"-1"},[R("深度图 "),w("a",{class:"header-anchor",href:"#深度图","aria-label":'Permalink to "深度图"'},"​")],-1),wt=w("h2",{id:"demo",tabindex:"-1"},[R("Demo "),w("a",{class:"header-anchor",href:"#demo","aria-label":'Permalink to "Demo"'},"​")],-1),Tt=w("h2",{id:"install",tabindex:"-1"},[R("Install "),w("a",{class:"header-anchor",href:"#install","aria-label":'Permalink to "Install"'},"​")],-1);function vt(o,t,i,s,e,h){const r=yt;return st(),et("div",null,[bt,wt,mt(r),Tt])}const Ht=ut(xt,[["render",vt]]);export{Ct as __pageData,Ht as default};
