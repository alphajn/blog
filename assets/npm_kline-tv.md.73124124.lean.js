import{_,a as f}from"./chunks/el-tag.7a3bcd18.js";import{d as E,u as v,a5 as q,l as h,k as B,a6 as k,o as g,c as m,C as l,J as i,b as x,S as T,U as S,_ as u,a as r,E as L,V as P}from"./chunks/framework.009e57ad.js";import{T as $}from"./chunks/Kline.vue_vue_type_style_index_0_scoped_1f26131b_lang.e8857780.js";import{l as K}from"./chunks/base.6c74be14.js";import"./chunks/el-option.4ed993c7.js";import"./chunks/el-button.4ed993c7.js";import"./chunks/index.4da49ac9.js";import"./chunks/index.f954909e.js";import"./chunks/index.0bdd1095.js";import"./chunks/index.7e71f9e5.js";const b=y=>(T("data-v-a47b77c9"),y=y(),S(),y),N={class:"options pb-8px! text-12px border-b-solid border-b border-amber mb-8px!"},w=b(()=>l("p",{class:"m-0! text-12px lh-12px! mb-4px!"}," 交易对 ",-1)),I=b(()=>l("p",{class:"m-0! text-12px lh-12px! mb-4px!"}," 语言 ",-1)),z={class:"h-400px"},M=E({__name:"TvKline",setup(y){const{isDark:C}=v();let a=null,d=null;const F={1:"1m",3:"3m",5:"5m",15:"15m",30:"30m",60:"1h",120:"2h",240:"4h",360:"6h",720:"12h","1D":"1d","1W":"1w","1M":"1M"},s=q({symbols:{},lang:"zh-CN",theme:"light",loading:!0,interval:"60",list:[],sub_list:[],latest_data:null,page_size:1e3}),c=h(()=>`symbol=${s.symbols.symbol}&interval=${F[s.interval]}&limit=${s.page_size}`),D=h(()=>({topic:`kline_${F[s.interval]}`,id:`kline_301${s.symbols.symbol}${F[s.interval]}`,params:{binary:!1,limit:1},symbol:s.symbols.symbol,event:"sub"})),p={getKline(){s.loading=!0,s.sub_list=[],s.latest_data=null,p.subKline();const t=c.value;fetch(`https://api.bybit.com/spot/api/quote/v2/klines?${t}`).then(n=>n.json()).then(n=>{s.loading=!1,n.ret_code===0&&t===c.value&&(s.list=p.formatList(n.result))})},subKline(){a=a||new WebSocket("wss://ws2.bybit.com/spot/ws/quote/v1");const t=()=>{d=setTimeout(()=>{a==null||a.send(JSON.stringify({ping:Date.now()}))},5e3)};a.readyState===1&&(a==null||a.send(JSON.stringify(D.value)),t()),a.onopen=()=>{a==null||a.send(JSON.stringify(D.value)),t()},a.onmessage=n=>{const o=JSON.parse(n.data);if(o.id===D.value.id){const e=p.formatList(o.data);s.loading?s.sub_list=e:([s.latest_data]=e,p.updateListLastData())}else o.pong&&t()}},loadMore(t,n){if(!t){n([]);return}const o=c.value;fetch(`https://api.bybit.com/spot/api/quote/v2/klines?${o}&to=${t-1e3}`).then(e=>e.json()).then(e=>{if(e.ret_code===0&&o===c.value){const A=p.formatList(e.result);n(A),s.list.unshift(...A)}})},updateListLastData(){var t;if(s.latest_data){const n=s.latest_data.time,o=(t=s.list.slice(-1)[0])==null?void 0:t.time;n===o?s.list.splice(-1,1,s.latest_data):n&&(!o||n>o)&&s.list.push(s.latest_data)}},unsub(){d&&clearTimeout(d),(a==null?void 0:a.readyState)===1&&(a==null||a.send(JSON.stringify({...D.value,event:"cancel"})))},changeSymbol(t){p.unsub(),s.symbols=t,s.interval&&p.getKline()},changeLang(t){s.lang=t},formatList(t){return t.map(n=>({id:`${s.symbols.symbol}_${s.interval}`,time:n.t,open:Number(n.o),close:Number(n.c),high:Number(n.h),low:Number(n.l),volume:Number(n.v)}))}};return B(()=>{s.theme=C.value?"dark":"light"}),k(()=>{p.unsub(),a==null||a.close()}),(t,n)=>{const o=_,e=f;return g(),m("section",null,[l("ul",N,[l("li",null,[w,i(o,{exchange:s.exchange,onChange:p.changeSymbol},null,8,["exchange","onChange"])]),l("li",null,[I,i(e,{lang:s.lang,onChange:p.changeLang},null,8,["lang","onChange"])])]),l("div",z,[i(x($),{interval:s.interval,loading:s.loading,theme:s.theme,lang:s.lang,symbol:s.symbols.symbol,"price-precision":s.symbols.pricePrecision,"quantity-precision":s.symbols.quantityPrecision,exchange:s.exchange,list:s.list,"latest-data":s.latest_data,"load-more":p.loadMore,"library-path":"/docs/public/charting_library/","limit-size":s.page_size,watermark:"Kline"},null,8,["interval","loading","theme","lang","symbol","price-precision","quantity-precision","exchange","list","latest-data","load-more","limit-size"])])])}}});const O=u(M,[["__scopeId","data-v-a47b77c9"]]),os=JSON.parse('{"title":"专业版","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"npm/kline-tv.md","lastUpdated":1701080813000}'),V={name:"npm/kline-tv.md"},J=l("h1",{id:"专业版",tabindex:"-1"},[r("专业版 "),l("a",{class:"header-anchor",href:"#专业版","aria-label":'Permalink to "专业版"'},"​")],-1),U=l("a",{href:"https://cn.tradingview.com/widget/advanced-chart/",target:"_blank",rel:"noreferrer"},"Tradingview",-1),R=l("a",{href:"https://www.tradingview.com/charting-library-docs/",target:"_blank",rel:"noreferrer"},"官方文档",-1),W=l("h2",{id:"demo",tabindex:"-1"},[r("Demo "),l("a",{class:"header-anchor",href:"#demo","aria-label":'Permalink to "Demo"'},"​")],-1),H=P("",20);function j(y,C,a,d,F,s){const c=K.ElTag,D=O;return g(),m("div",null,[J,l("p",null,[r("基于 "),U,r(),i(c,{round:"",small:""},{default:L(()=>[r("26.003")]),_:1}),r(" 开发，"),R,r("。")]),W,i(D),H])}const ps=u(V,[["render",j]]);export{os as __pageData,ps as default};
