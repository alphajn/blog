import{u as H,l as S}from"./chunks/index.ce378cf5.js";import"./chunks/el-option.4ed993c7.js";import{d as I,ad as V,o as c,c as i,F as B,R as P,n as f,C as l,t as q,K as N,G as U,_ as T,a5 as L,l as y,a6 as z,J as _,E as Q,D as J,b as v,S as R,U as G,a as $,V as K}from"./chunks/framework.009e57ad.js";import{a as g,w as E,s as h,m as M,f as j}from"./chunks/index.7e71f9e5.js";import{E as W}from"./chunks/index.1b21bfbe.js";import"./chunks/index.f954909e.js";import"./chunks/index.0bdd1095.js";const X=["onClick"],Y=I({__name:"OrderBookTable",props:{side:{type:String,default:""},list:{type:Array,default:()=>[]},buyColor:{type:String,default:"#15bb7a"},sellColor:{type:String,default:"#d2334d"},lineHeight:{type:String,default:"16px"},newIndex:{type:Number,default:0}},emits:["click"],setup(r,{emit:e}){V(D=>({f5d57880:s.lineHeight,"250d110c":s.sellColor,"3b925f42":s.buyColor}));const s=r,C=e,u={emitClick(D){/\d/.test(D.price)&&C("click",D.price.replace(/,/g,""))}};return(D,b)=>(c(),i("ul",{class:f(["list-wrap",[s.side?`is-${s.side}`:""]])},[(c(!0),i(B,null,P(s.list,(p,A)=>(c(),i("li",{key:A,class:f(["item",{new:A<s.newIndex}]),onClick:w=>u.emitClick(p)},[l("span",{class:f([p.side?`is-${p.side}`:""])},q(p.price),3),l("span",null,q(p.quantity),1),l("span",null,q(p.column3),1),p.scale?(c(),i("div",{key:0,class:"scale",style:N({transform:`scale3d(${p.scale}, 1, 1)`})},null,4)):U("",!0)],10,X))),128))],2))}});const x=T(Y,[["__scopeId","data-v-6533462b"]]),m=r=>(R("data-v-ea3b1ea7"),r=r(),G(),r),Z=m(()=>l("h4",{class:"mt-12px"}," 订单簿 ",-1)),ss=m(()=>l("ul",{class:"table-header grid grid-cols-3"},[l("li",{class:"text-left"}," 價格(USDT) "),l("li",null,"數量(BTC)"),l("li",null,"累計(BTC)")],-1)),as=m(()=>l("div",{class:"h-1px bg-yellow-500 my-4px"},null,-1)),ns=m(()=>l("h4",{class:"mt-20px"}," 最新成交 ",-1)),ls=m(()=>l("ul",{class:"table-header grid grid-cols-3"},[l("li",{class:"text-left"}," 價格(USDT) "),l("li",null,"數量(BTC)"),l("li",null,"時間")],-1)),os=I({__name:"OrderBook",setup(r){const e=new H("wss://ws.meex.com/kline-api/ws",{name:"ob-ws",retry:100}),s=L({limit:10,limit_options:[1,5,10,20,50,100,200],price_precision:2,quantity_precision:5,order_book:{sells:[],buys:[]},deal:[],deal_sub:[],deal_sub_timer:null}),C=y(()=>s.order_book.sells.slice(0,s.limit)),u=y(()=>s.order_book.buys.slice(0,s.limit)),D=y(()=>{const a=C.value.reduce((n,o)=>g(n,o[1]),"0");return E(a,s.limit)}),b=y(()=>{const a=u.value.reduce((n,o)=>g(n,o[1]),"0");return E(a,s.limit)}),p=y(()=>E(g(D.value,b.value),2)),A=y(()=>{const a=t.formatOrderBook(C.value).reverse(),n=t.formatOrderBook(u.value);return{sells:a,buys:n}}),w=y(()=>{const a=s.deal.slice(0,s.limit);let n=Array.from({length:s.limit}).fill({price:"--",quantity:"--",column3:"--"});return a.length&&(n=a.map(o=>({side:o.side.toLowerCase(),price:h(o.price,s.price_precision),quantity:h(o.vol,s.quantity_precision),column3:o.ds.split(" ")[1]||"--"}))),n}),t={init(){t.subOrderBook(),t.reqDeal(),t.subDeal()},subOrderBook(){e.send({event:"sub",params:{channel:"market_btcusdt_depth_step0"}},a=>{a.success&&(s.order_book={sells:a.tick.asks,buys:a.tick.buys})})},reqDeal(){e.send({event:"req",params:{channel:"market_btcusdt_trade_ticker",top:100}},a=>{if(a.success){const n=a.data;if(s.deal_sub.length){const o=n.slice(0,1)[0];s.deal_sub.forEach(F=>{F.id>o.id&&n.unshift(F)}),s.deal=n.slice(0,200),s.deal_sub=[]}s.deal=n}})},subDeal(){e.send({event:"sub",params:{channel:"market_btcusdt_trade_ticker",top:100}},a=>{if(a.success){const n=a.tick.data.reverse();s.deal.length?(s.deal.unshift(...n),s.deal=s.deal.slice(0,200),s.deal_sub=n,s.deal_sub_timer&&clearTimeout(s.deal_sub_timer),s.deal_sub_timer=setTimeout(()=>{s.deal_sub=[]},300)):s.deal_sub.push(...n)}})},clickHandle(a){W({title:"选择价格",message:a,type:"info"})},formatOrderBook(a){let n="0";const o=Math.max(s.limit-a.length,0),F=Array.from({length:o}).fill({price:"--",quantity:"--",column3:"--"});return[...a.map(k=>{n=g(n,k[1]);const O=M(E(k[1],p.value),4);return{price:h(k[0],s.price_precision),quantity:h(k[1],s.quantity_precision),column3:h(n,s.quantity_precision),scale:j(O,1)?1:O}}),...F]}};return t.init(),z(()=>{e.send({event:"unsub",params:{channel:"market_btcusdt_depth_step0"}},()=>{}),e.send({event:"unsub",params:{channel:"market_btcusdt_trade_ticker"}},()=>{}),e.close()}),(a,n)=>{const o=S.ElOption,F=S.ElSelect;return c(),i(B,null,[_(F,{modelValue:s.limit,"onUpdate:modelValue":n[0]||(n[0]=d=>s.limit=d),size:"small"},{default:Q(()=>[(c(!0),i(B,null,P(s.limit_options,d=>(c(),J(o,{key:d,label:`展示${d}条`,value:d},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),Z,ss,_(v(x),{list:A.value.sells,side:"sell",onClick:t.clickHandle},null,8,["list","onClick"]),as,_(v(x),{list:A.value.buys,side:"buy",onClick:t.clickHandle},null,8,["list","onClick"]),ns,ls,_(v(x),{list:w.value,"new-index":s.deal_sub.length,"line-height":"20px",onClick:t.clickHandle},null,8,["list","new-index","onClick"])],64)}}});const ps=T(os,[["__scopeId","data-v-ea3b1ea7"]]),hs=JSON.parse('{"title":"订单簿列表","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"npm/vue-order-book.md","lastUpdated":1686190063000}'),es={name:"npm/vue-order-book.md"},ts=l("h1",{id:"订单簿列表",tabindex:"-1"},[$("订单簿列表 "),l("a",{class:"header-anchor",href:"#订单簿列表","aria-label":'Permalink to "订单簿列表"'},"​")],-1),cs=l("h2",{id:"demo",tabindex:"-1"},[$("Demo "),l("a",{class:"header-anchor",href:"#demo","aria-label":'Permalink to "Demo"'},"​")],-1),rs=K("",17);function Ds(r,e,s,C,u,D){const b=ps;return c(),i("div",null,[ts,cs,_(b),rs])}const _s=T(es,[["render",Ds]]);export{hs as __pageData,_s as default};
