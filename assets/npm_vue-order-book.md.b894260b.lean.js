import{o as H,l as O}from"./chunks/index.47c7e16f.js";import"./chunks/el-option.4ed993c7.js";import{d as S,aa as V,o as r,c as i,F as B,R as $,n as E,C as l,t as q,K as N,G as U,_ as w,a6 as L,l as y,a7 as z,J as A,E as Q,D as J,b as v,S as R,U as G,a as I,V as K}from"./chunks/framework.09a4f1e2.js";import{p as b,w as k,m as u,s as M,g as j}from"./chunks/index.574a0076.js";import{E as W}from"./chunks/index.78200dd0.js";import"./chunks/index.5f4006a6.js";const X=["onClick"],Y=S({__name:"OrderBookTable",props:{side:{type:String,default:""},list:{type:Array,default:()=>[]},buyColor:{type:String,default:"#15bb7a"},sellColor:{type:String,default:"#d2334d"},lineHeight:{type:String,default:"16px"},newIndex:{type:Number,default:0}},emits:["click"],setup(D,{emit:t}){const s=D;V(c=>({f5d57880:s.lineHeight,"250d110c":s.sellColor,"3b925f42":s.buyColor}));const C={emitClick(c){/\d/.test(c.price)&&t("click",c.price.replace(/,/g,""))}};return(c,g)=>(r(),i("ul",{class:E(["list-wrap",[s.side?`is-${s.side}`:""]])},[(r(!0),i(B,null,$(s.list,(e,h)=>(r(),i("li",{key:h,class:E(["item",{new:h<s.newIndex}]),onClick:f=>C.emitClick(e)},[l("span",{class:E([e.side?`is-${e.side}`:""])},q(e.price),3),l("span",null,q(e.quantity),1),l("span",null,q(e.column3),1),e.scale?(r(),i("div",{key:0,class:"scale",style:N({transform:`scale3d(${e.scale}, 1, 1)`})},null,4)):U("",!0)],10,X))),128))],2))}});const x=w(Y,[["__scopeId","data-v-6533462b"]]),_=D=>(R("data-v-ef165671"),D=D(),G(),D),Z=_(()=>l("h4",{class:"mt-12px"}," 订单簿 ",-1)),ss=_(()=>l("ul",{class:"table-header grid grid-cols-3"},[l("li",{class:"text-left"}," 價格(USDT) "),l("li",null,"數量(BTC)"),l("li",null,"累計(BTC)")],-1)),as=_(()=>l("div",{class:"h-1px bg-yellow-500 my-4px"},null,-1)),ns=_(()=>l("h4",{class:"mt-20px"}," 最新成交 ",-1)),ls=_(()=>l("ul",{class:"table-header grid grid-cols-3"},[l("li",{class:"text-left"}," 價格(USDT) "),l("li",null,"數量(BTC)"),l("li",null,"時間")],-1)),os=S({__name:"OrderBook",setup(D){const t=new H("wss://ws.meex.com/kline-api/ws",{name:"ob-ws",retry:100}),s=L({limit:10,limit_options:[1,5,10,20,50,100,200],price_precision:2,quantity_precision:5,order_book:{sells:[],buys:[]},deal:[],deal_sub:[],deal_sub_timer:null}),C=y(()=>s.order_book.sells.slice(0,s.limit)),c=y(()=>s.order_book.buys.slice(0,s.limit)),g=y(()=>{const a=C.value.reduce((n,o)=>b(n,o[1]),"0");return k(a,s.limit)}),e=y(()=>{const a=c.value.reduce((n,o)=>b(n,o[1]),"0");return k(a,s.limit)}),h=y(()=>k(b(g.value,e.value),2)),f=y(()=>{const a=p.formatOrderBook(C.value).reverse(),n=p.formatOrderBook(c.value);return{sells:a,buys:n}}),P=y(()=>{const a=s.deal.slice(0,s.limit);let n=new Array(s.limit).fill({price:"--",quantity:"--",column3:"--"});return a.length&&(n=a.map(o=>({side:o.side.toLowerCase(),price:u(o.price,s.price_precision),quantity:u(o.vol,s.quantity_precision),column3:o.ds.split(" ")[1]||"--"}))),n}),p={init(){p.subOrderBook(),p.reqDeal(),p.subDeal()},subOrderBook(){t.send({event:"sub",params:{channel:"market_btcusdt_depth_step0"}},a=>{a.success&&(s.order_book={sells:a.tick.asks,buys:a.tick.buys})})},reqDeal(){t.send({event:"req",params:{channel:"market_btcusdt_trade_ticker",top:100}},a=>{if(a.success){const n=a.data;if(s.deal_sub.length){const o=n.slice(0,1)[0];s.deal_sub.forEach(F=>{F.id>o.id&&n.unshift(F)}),s.deal=n.slice(0,200),s.deal_sub=[]}s.deal=n}})},subDeal(){t.send({event:"sub",params:{channel:"market_btcusdt_trade_ticker",top:100}},a=>{if(a.success){const n=a.tick.data.reverse();s.deal.length?(s.deal.unshift(...n),s.deal=s.deal.slice(0,200),s.deal_sub=n,s.deal_sub_timer&&clearTimeout(s.deal_sub_timer),s.deal_sub_timer=setTimeout(()=>{s.deal_sub=[]},300)):s.deal_sub.push(...n)}})},clickHandle(a){W({title:"选择价格",message:a,type:"info"})},formatOrderBook(a){let n="0";const o=Math.max(s.limit-a.length,0),F=new Array(o).fill({price:"--",quantity:"--",column3:"--"});return[...a.map(m=>{n=b(n,m[1]);const T=M(k(m[1],h.value),4);return{price:u(m[0],s.price_precision),quantity:u(m[1],s.quantity_precision),column3:u(n,s.quantity_precision),scale:j(T,1)?1:T}}),...F]}};return p.init(),z(()=>{t.send({event:"unsub",params:{channel:"market_btcusdt_depth_step0"}},()=>{}),t.send({event:"unsub",params:{channel:"market_btcusdt_trade_ticker"}},()=>{}),t.close()}),(a,n)=>{const o=O.ElOption,F=O.ElSelect;return r(),i(B,null,[A(F,{modelValue:s.limit,"onUpdate:modelValue":n[0]||(n[0]=d=>s.limit=d),size:"small"},{default:Q(()=>[(r(!0),i(B,null,$(s.limit_options,d=>(r(),J(o,{key:d,label:`展示${d}条`,value:d},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),Z,ss,A(v(x),{list:f.value.sells,side:"sell",onClick:p.clickHandle},null,8,["list","onClick"]),as,A(v(x),{list:f.value.buys,side:"buy",onClick:p.clickHandle},null,8,["list","onClick"]),ns,ls,A(v(x),{list:P.value,"new-index":s.deal_sub.length,"line-height":"20px",onClick:p.clickHandle},null,8,["list","new-index","onClick"])],64)}}});const es=w(os,[["__scopeId","data-v-ef165671"]]),As=JSON.parse('{"title":"订单簿列表","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"npm/vue-order-book.md","lastUpdated":1686107713000}'),ts={name:"npm/vue-order-book.md"},ps=l("h1",{id:"订单簿列表",tabindex:"-1"},[I("订单簿列表 "),l("a",{class:"header-anchor",href:"#订单簿列表","aria-label":'Permalink to "订单簿列表"'},"​")],-1),cs=l("h2",{id:"demo",tabindex:"-1"},[I("Demo "),l("a",{class:"header-anchor",href:"#demo","aria-label":'Permalink to "Demo"'},"​")],-1),rs=K("",13);function Ds(D,t,s,C,c,g){const e=es;return r(),i("div",null,[ps,cs,A(e),rs])}const _s=w(ts,[["render",Ds]]);export{As as __pageData,_s as default};
