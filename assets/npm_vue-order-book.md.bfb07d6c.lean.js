import{u as H,l as O}from"./chunks/index.47678fbe.js";import"./chunks/el-option.4ed993c7.js";import{d as S,aa as V,o as r,c as i,F as B,R as I,n as f,C as l,t as q,K as N,G as U,_ as T,a5 as L,l as y,a8 as z,J as A,E as Q,D as J,b as v,S as R,U as G,a as P,V as K}from"./chunks/framework.bf2e8274.js";import{a as b,w as k,s as u,m as M,f as j}from"./chunks/index.7e71f9e5.js";import{E as W}from"./chunks/index.8f54c6b9.js";import"./chunks/index.60e2756f.js";const X=["onClick"],Y=S({__name:"OrderBookTable",props:{side:{type:String,default:""},list:{type:Array,default:()=>[]},buyColor:{type:String,default:"#15bb7a"},sellColor:{type:String,default:"#d2334d"},lineHeight:{type:String,default:"16px"},newIndex:{type:Number,default:0}},emits:["click"],setup(D,{emit:e}){const s=D;V(c=>({f5d57880:s.lineHeight,"250d110c":s.sellColor,"3b925f42":s.buyColor}));const C={emitClick(c){/\d/.test(c.price)&&e("click",c.price.replace(/,/g,""))}};return(c,g)=>(r(),i("ul",{class:f(["list-wrap",[s.side?`is-${s.side}`:""]])},[(r(!0),i(B,null,I(s.list,(p,_)=>(r(),i("li",{key:_,class:f(["item",{new:_<s.newIndex}]),onClick:E=>C.emitClick(p)},[l("span",{class:f([p.side?`is-${p.side}`:""])},q(p.price),3),l("span",null,q(p.quantity),1),l("span",null,q(p.column3),1),p.scale?(r(),i("div",{key:0,class:"scale",style:N({transform:`scale3d(${p.scale}, 1, 1)`})},null,4)):U("",!0)],10,X))),128))],2))}});const x=T(Y,[["__scopeId","data-v-6533462b"]]),h=D=>(R("data-v-ea3b1ea7"),D=D(),G(),D),Z=h(()=>l("h4",{class:"mt-12px"}," 订单簿 ",-1)),ss=h(()=>l("ul",{class:"table-header grid grid-cols-3"},[l("li",{class:"text-left"}," 價格(USDT) "),l("li",null,"數量(BTC)"),l("li",null,"累計(BTC)")],-1)),as=h(()=>l("div",{class:"h-1px bg-yellow-500 my-4px"},null,-1)),ns=h(()=>l("h4",{class:"mt-20px"}," 最新成交 ",-1)),ls=h(()=>l("ul",{class:"table-header grid grid-cols-3"},[l("li",{class:"text-left"}," 價格(USDT) "),l("li",null,"數量(BTC)"),l("li",null,"時間")],-1)),os=S({__name:"OrderBook",setup(D){const e=new H("wss://ws.meex.com/kline-api/ws",{name:"ob-ws",retry:100}),s=L({limit:10,limit_options:[1,5,10,20,50,100,200],price_precision:2,quantity_precision:5,order_book:{sells:[],buys:[]},deal:[],deal_sub:[],deal_sub_timer:null}),C=y(()=>s.order_book.sells.slice(0,s.limit)),c=y(()=>s.order_book.buys.slice(0,s.limit)),g=y(()=>{const a=C.value.reduce((n,o)=>b(n,o[1]),"0");return k(a,s.limit)}),p=y(()=>{const a=c.value.reduce((n,o)=>b(n,o[1]),"0");return k(a,s.limit)}),_=y(()=>k(b(g.value,p.value),2)),E=y(()=>{const a=t.formatOrderBook(C.value).reverse(),n=t.formatOrderBook(c.value);return{sells:a,buys:n}}),$=y(()=>{const a=s.deal.slice(0,s.limit);let n=Array.from({length:s.limit}).fill({price:"--",quantity:"--",column3:"--"});return a.length&&(n=a.map(o=>({side:o.side.toLowerCase(),price:u(o.price,s.price_precision),quantity:u(o.vol,s.quantity_precision),column3:o.ds.split(" ")[1]||"--"}))),n}),t={init(){t.subOrderBook(),t.reqDeal(),t.subDeal()},subOrderBook(){e.send({event:"sub",params:{channel:"market_btcusdt_depth_step0"}},a=>{a.success&&(s.order_book={sells:a.tick.asks,buys:a.tick.buys})})},reqDeal(){e.send({event:"req",params:{channel:"market_btcusdt_trade_ticker",top:100}},a=>{if(a.success){const n=a.data;if(s.deal_sub.length){const o=n.slice(0,1)[0];s.deal_sub.forEach(F=>{F.id>o.id&&n.unshift(F)}),s.deal=n.slice(0,200),s.deal_sub=[]}s.deal=n}})},subDeal(){e.send({event:"sub",params:{channel:"market_btcusdt_trade_ticker",top:100}},a=>{if(a.success){const n=a.tick.data.reverse();s.deal.length?(s.deal.unshift(...n),s.deal=s.deal.slice(0,200),s.deal_sub=n,s.deal_sub_timer&&clearTimeout(s.deal_sub_timer),s.deal_sub_timer=setTimeout(()=>{s.deal_sub=[]},300)):s.deal_sub.push(...n)}})},clickHandle(a){W({title:"选择价格",message:a,type:"info"})},formatOrderBook(a){let n="0";const o=Math.max(s.limit-a.length,0),F=Array.from({length:o}).fill({price:"--",quantity:"--",column3:"--"});return[...a.map(m=>{n=b(n,m[1]);const w=M(k(m[1],_.value),4);return{price:u(m[0],s.price_precision),quantity:u(m[1],s.quantity_precision),column3:u(n,s.quantity_precision),scale:j(w,1)?1:w}}),...F]}};return t.init(),z(()=>{e.send({event:"unsub",params:{channel:"market_btcusdt_depth_step0"}},()=>{}),e.send({event:"unsub",params:{channel:"market_btcusdt_trade_ticker"}},()=>{}),e.close()}),(a,n)=>{const o=O.ElOption,F=O.ElSelect;return r(),i(B,null,[A(F,{modelValue:s.limit,"onUpdate:modelValue":n[0]||(n[0]=d=>s.limit=d),size:"small"},{default:Q(()=>[(r(!0),i(B,null,I(s.limit_options,d=>(r(),J(o,{key:d,label:`展示${d}条`,value:d},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),Z,ss,A(v(x),{list:E.value.sells,side:"sell",onClick:t.clickHandle},null,8,["list","onClick"]),as,A(v(x),{list:E.value.buys,side:"buy",onClick:t.clickHandle},null,8,["list","onClick"]),ns,ls,A(v(x),{list:$.value,"new-index":s.deal_sub.length,"line-height":"20px",onClick:t.clickHandle},null,8,["list","new-index","onClick"])],64)}}});const ps=T(os,[["__scopeId","data-v-ea3b1ea7"]]),As=JSON.parse('{"title":"订单簿列表","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"npm/vue-order-book.md","lastUpdated":1686190063000}'),es={name:"npm/vue-order-book.md"},ts=l("h1",{id:"订单簿列表",tabindex:"-1"},[P("订单簿列表 "),l("a",{class:"header-anchor",href:"#订单簿列表","aria-label":'Permalink to "订单簿列表"'},"​")],-1),cs=l("h2",{id:"demo",tabindex:"-1"},[P("Demo "),l("a",{class:"header-anchor",href:"#demo","aria-label":'Permalink to "Demo"'},"​")],-1),rs=K("",17);function Ds(D,e,s,C,c,g){const p=ps;return r(),i("div",null,[ts,cs,A(p),rs])}const hs=T(es,[["render",Ds]]);export{As as __pageData,hs as default};
