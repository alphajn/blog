import{d as A,ah as D,D as m,v as B,$ as f,c as k,o as d,F as g,j as n,n as o,k as c,t as r,aj as v,aw as _,B as x,e as E,a as w,_ as u,ag as y,G as S}from"./chunks/framework.Cghu_Lar.js";import{b as F}from"./chunks/index.B8mzIwg2.js";import{f as T,w as q}from"./chunks/config.CIuV0BFT.js";const U={class:"flex flex-row flex-wrap gap-10px fw-bold"},N=["innerHTML"],P={class:"ml-auto select-none flex items-center gap-x-4px"},O={class:"mt-8px flex flex-col gap-y-16px"},j={class:"flex justify-between items-center pb-6px gap-x-6px sticky top-64px pt-6px bg-[var(--vp-c-bg)] b-b-solid b-b-#909399 b-b-0.5px"},I={class:"c-#67C23A fw-bold"},V={class:"flex gap-x-8px shrink-0"},W=["onClick"],R=["disabled","onClick"],$={key:0,class:"i-svg-spinners:tadpole c-#F56C6C mr-4px"},M={class:"py-6px fw-500"},L={class:"c-#909399 lh-[1.4] my-0 indent-0"},H={class:"py-6px fw-500"},z={class:"c-#909399 lh-[1.4] my-0 overflow-auto max-h-800px"},J=A({__name:"Ws",setup(C){let h=0;const i=D({status:"关闭",connect_time:"--",binary:!1,sends:{overview:{title:"订阅所有交易对行情",loading:!1,subing:!1,data:null,update:!1,timer:null,send:{event:"sub",topic:"slowBroker",id:"sub_slowBroker"}},ticker:{title:"订阅当前交易对最新行情（会产生多条，最后一条为最新）",loading:!1,subing:!1,data:null,update:!1,timer:null,send:{event:"sub",topic:"realtimes",symbol:"BTCUSDT",id:"sub_realtimes_BTCUSDT"}},order_book:{title:"订阅盘口挂单列表（精度2, 20条）",loading:!1,subing:!1,data:null,update:!1,timer:null,send:{event:"sub",topic:"mergedDepth",symbol:"BTCUSDT",id:"sub_mergedDepth_BTCUSDT",limit:20,params:{dumpScale:2}}},deal:{title:"订阅最新成交（40条）",loading:!1,subing:!1,data:null,update:!1,timer:null,send:{event:"sub",topic:"trade",id:"sub_trade_BTCUSDT",symbol:"BTCUSDT",limit:40}},kline:{title:"订阅 kline 1 小时数据（最新1条）",loading:!1,subing:!1,data:null,update:!1,timer:null,send:{event:"sub",topic:"kline_1h",symbol:"BTCUSDT",id:"sub_kline_1h_BTCUSDT",params:{limit:1}}},depth:{title:"订阅深度图数据",loading:!1,subing:!1,data:null,update:!1,timer:null,send:{event:"sub",topic:"depth",symbol:"BTCUSDT",id:"sub_depth_BTCUSDT"}}}}),p=m(null),e={init(){p.value=new T(q,{retry:100,heart:!0,binary:i.binary,onCreate:a=>{i.connect_time="--",i.status=a===0?'<span class="c-#409EFF">正在连接</span>':'<span class="c-#E6A23C">正在重连</span>',h=Date.now()},onOpen:()=>{i.status='<span class="c-#67C23A">已连接</span>',i.connect_time=String(Date.now()-h)},onClose:()=>{i.status='<span class="c-#F56C6C">关闭</span>'}})},send(a){var l;const s=i.sends[a];s.loading=!0,(l=p.value)==null||l.send(s.send,t=>{s.data=t,s.loading=!1,s.send.event==="sub"&&(s.subing=!0),this.setUpdateStyle(s)})},unSub(a){var l;const s=i.sends[a];s.send.event==="sub"&&(s.subing=!1),(l=p.value)==null||l.send({...s.send,event:"cancel"},()=>{s.data=null})},setUpdateStyle(a){a.data&&(a.update=!0,a.timer&&clearTimeout(a.timer),setTimeout(()=>{a.update=!1},300))},onChangeBinary(){var a;Object.keys(i.sends).forEach(e.unSub),(a=p.value)==null||a.close(),e.init()}};return B(()=>{e.init()}),f(()=>{var a;Object.keys(i.sends).forEach(e.unSub),(a=p.value)==null||a.close()}),(a,s)=>(d(),k(g,null,[n("div",U,[s[3]||(s[3]=n("span",{class:"c-#F56C6C"}," ws状态: ",-1)),n("span",{class:"c-#909399",innerHTML:i.status},null,8,N),s[4]||(s[4]=n("span",{class:"ml-24px c-#E6A23C"}," 连接耗时: ",-1)),n("span",{class:o([i.connect_time==="--"?"c-#909399":c(F)(i.connect_time,500)?"c-#67C23A":c(F)(i.connect_time,1e3)?"c-#E6A23C":"c-#F56C6C"])},r(i.connect_time)+" ms ",3),n("span",P,[v(n("input",{id:"binary","onUpdate:modelValue":s[0]||(s[0]=l=>i.binary=l),type:"checkbox",class:"m-0 w-16px h-16px",onChange:s[1]||(s[1]=(...l)=>e.onChangeBinary&&e.onChangeBinary(...l))},null,544),[[_,i.binary]]),s[2]||(s[2]=n("label",{for:"binary",class:"c-#909399 cursor-pointer"},"返回二进制数据",-1))])]),n("div",O,[(d(!0),k(g,null,x(Object.entries(i.sends),([l,t])=>(d(),k("div",{key:l,class:o(["p-10px rd-10px transition-duration-300",{"has-update":t.update}])},[n("div",j,[n("span",I,r(t.title),1),n("div",V,[t.send.event==="sub"&&t.subing?(d(),k("button",{key:0,type:"button",class:"bg-#F56C6C c-white rd-4px px-10px transition-duration-300 hover:opacity-80",onClick:b=>e.unSub(l)}," 取消 ",8,W)):E("",!0),n("button",{disabled:t.loading||t.subing,type:"button",class:o(["bg-#67C23A c-white rd-4px px-10px flex items-center transition-duration-300 hover:opacity-80",{"opacity-50 cursor-progress":t.loading,"opacity-50 cursor-not-allowed":t.subing}]),onClick:b=>e.send(l)},[t.loading?(d(),k("div",$)):E("",!0),w(" "+r(t.send.event==="sub"?"订阅":"取消"),1)],10,R)])]),n("details",M,[s[5]||(s[5]=n("summary",{class:"c-#409EFF cursor-pointer !my-0"}," 发送数据: ",-1)),n("pre",L,r(JSON.stringify(t.send,null,4)),1)]),n("details",H,[s[6]||(s[6]=n("summary",{class:"c-#E6A23C cursor-pointer !my-0"}," 接收数据: ",-1)),n("pre",z,r(JSON.stringify(t.data,null,4)),1)])],2))),128))])],64))}}),K=u(J,[["__scopeId","data-v-efea52d2"]]),ss=JSON.parse('{"title":"Socket","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"npm/ws.md","filePath":"npm/ws.md","lastUpdated":1721378222000}'),G={name:"npm/ws.md"};function Q(C,h,i,p,e,a){const s=K;return d(),k("div",null,[h[0]||(h[0]=y("",4)),S(s),h[1]||(h[1]=y("",23))])}const is=u(G,[["render",Q]]);export{ss as __pageData,is as default};
